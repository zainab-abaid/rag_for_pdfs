# =============================================================================
# PDF Markdown RAG System - Environment Variables
# =============================================================================
# Copy this file to .env and fill in your values
# Note: .env is gitignored and should never be committed

# =============================================================================
# DATABASE CONFIGURATION (Required)
# =============================================================================
# PostgreSQL connection settings
PG_HOST=localhost
PG_PORT=5432
PG_DB=extreme_pdfs
PG_SCHEMA=extreme_pdfs_schema
PG_USER=your_username
PG_PASSWORD=your_password

# Table name for vector store (default: idx_section_based_chunking)
PG_TABLE=idx_section_based_chunking

# PostgreSQL text search configuration (default: english)
# Options: simple, english, etc. (must be installed in PostgreSQL)
TEXT_SEARCH_CONFIG=english

# =============================================================================
# EMBEDDING CONFIGURATION (Required)
# =============================================================================
# OpenAI embedding model
EMBED_MODEL=text-embedding-3-small

# Embedding dimensions (must match the model)
# text-embedding-3-small: 1536
# text-embedding-3-large: 3072
EMBED_DIM=1536

# OpenAI API key (required for embeddings and dataset generation)
OPENAI_API_KEY=your_openai_api_key_here

# =============================================================================
# CHUNKING CONFIGURATION (Optional - has defaults)
# =============================================================================
# Input directory containing markdown files
INPUT_DIR_FOR_CHUNKING=./data/md

# Output directory for chunk JSON files
OUTPUT_DIR=./data/sectionwise_chunks

# Maximum characters per chunk before splitting (default: 4000)
MAX_CHARS=4000

# Overlap between consecutive splits in characters (default: 180)
SPLIT_OVERLAP_CHARS=180

# Minimum section size to mark as small (default: 250)
MIN_CHARS=250

# Keep front-matter sections (default: false)
# If true, sections in DROP_TITLES catalog will not be filtered
KEEP_FRONT_MATTER=false

# =============================================================================
# INGESTION CONFIGURATION (Optional - has defaults)
# =============================================================================
# Drop and recreate table if it exists (default: false)
# WARNING: Set to true will delete all existing data!
OVERWRITE_TABLE=false

# =============================================================================
# RETRIEVAL CONFIGURATION (Optional - has defaults)
# =============================================================================
# Initial dense (vector) retrieval top-K (default: 30)
RETRIEVE_TOP_K=30

# Sparse (BM25) retrieval top-K (default: 30)
SPARSE_TOP_K=30

# Final number of assembled sections to return per query (default: 5)
FINAL_K=5

# Input CSV path for queries (default: ./data/manual_queries_from_chunks.csv)
DATASET_QUERIES=./data/manual_queries_from_chunks.csv

# Output CSV path for retrieval results (default: ./data/retrieved_contexts.csv)
OUTPUT_CSV=./data/retrieved_contexts.csv

# =============================================================================
# POSTFILTERING CONFIGURATION (Optional - has defaults)
# =============================================================================
# Product-aware postfiltering mode (default: none)
# Options:
#   none  - No filtering
#   soft  - Stable-partition: product hits first, then the rest
#   hard  - Keep only product hits; if none, fall back to original list
POSTFILTER_MODE=none

# Fields to search for product mentions (comma-separated)
# Options: doc_title, section_path, text, meta
POSTFILTER_FIELDS=doc_title,section_path,text

# =============================================================================
# RERANKING CONFIGURATION (Optional - has defaults)
# =============================================================================
# Reranker mode (default: none)
# Options:
#   none    - No reranking
#   entity  - Entity-aware reranking
#   rrf     - Reciprocal Rank Fusion (requires custom implementation)
#   mmr     - Maximal Marginal Relevance (requires custom implementation)
#   custom  - Custom reranker via RERANKER_SPEC
RERANKER_MODE=none

# Custom reranker specification (for custom mode)
# Format: 'package.module:callable_name'
# RERANKER_SPEC=

# Original score weight in reranking (0.0-1.0, default: 0.60)
RERANK_ORIG_WEIGHT=0.60

# Enable fuzzy matching in reranking (default: true)
RERANK_USE_FUZZY=true

# Fuzzy matching threshold (0-100, default: 85)
RERANK_FUZZY_MIN=85

# Product entity exact match bonus (default: 1.00)
RERANK_PRODUCT_EXACT_BONUS=1.00

# Product entity fuzzy match bonus (default: 0.35)
RERANK_PRODUCT_FUZZY_BONUS=0.35

# Generic entity exact match bonus (default: 0.45)
RERANK_GENERIC_EXACT_BONUS=0.45

# Generic entity fuzzy match bonus (default: 0.15)
RERANK_GENERIC_FUZZY_BONUS=0.15

# Minimum entity tokens to consider (default: 1)
RERANK_MIN_ENTITY_TOKENS=1

# Minimum IDF weight threshold (default: 0.40)
RERANK_MIN_IDF_WEIGHT=0.40

# Minimum active entities required (default: 1)
RERANK_MIN_ACTIVE_ENTITIES=1

# IDF calculation mode (default: log)
# Options: log, linear, etc.
RERANK_IDF_MODE=log

# =============================================================================
# DATASET GENERATION CONFIGURATION (Required for generate_dataset_llm.py)
# =============================================================================
# Directory containing chunk JSON files (required)
chunks_dir=./data/sectionwise_chunks

# Target number of Q&A pairs to generate (required)
QUERY_DATASET_SIZE=200

# Model for gate-keeping (filtering chunks) (default: gpt-4o-mini)
SKIP_JUDGE_MODEL=gpt-4o-mini

# Model for Q&A generation (default: gpt-4o-mini)
QA_MODEL=gpt-4o-mini

# Maximum context length in characters (default: 12000)
MAX_CONTEXT_CHARS=12000

# =============================================================================
# EVALUATION CONFIGURATION (Optional - has defaults)
# =============================================================================
# Output path for evaluation results (default: adds _eval suffix to OUTPUT_CSV)
# EVAL_OUTPUT_CSV=./data/retrieved_contexts_eval.csv